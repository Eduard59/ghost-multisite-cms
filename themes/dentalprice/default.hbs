<!DOCTYPE html>
<html lang="{{@site.locale}}">
<head>
    {{ghost_head}}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    {{!-- Tailwind CSS --}}
    <script src="https://cdn.tailwindcss.com"></script>
    
    {{!-- Custom configuration for Tailwind --}}
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        'primary-dark': '#2563EB',
                        'primary-light': '#60A5FA'
                    }
                }
            }
        }
    </script>
    
    {{!-- Custom styles --}}
    <style>
        .ghost-content h2 {
            @apply text-2xl font-bold mt-8 mb-4;
        }
        .ghost-content h3 {
            @apply text-xl font-semibold mt-6 mb-3;
        }
        .ghost-content p {
            @apply mb-4 leading-relaxed;
        }
        .ghost-content ul, .ghost-content ol {
            @apply mb-4 ml-6;
        }
        .ghost-content li {
            @apply mb-2;
        }
        .ghost-content a {
            @apply text-primary hover:text-primary-dark underline;
        }
        .ghost-content blockquote {
            @apply border-l-4 border-primary pl-4 italic my-4;
        }
        .ghost-content code {
            @apply bg-gray-100 px-1 py-0.5 rounded text-sm;
        }
        .ghost-content pre {
            @apply bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto my-4;
        }
        
        /* HubSpot Form Styling */
        .hs-form {
            @apply space-y-4;
        }
        .hs-form .hs-form-field {
            @apply mb-4;
        }
        .hs-form .hs-form-field label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .hs-form .hs-form-field input[type="email"],
        .hs-form .hs-form-field input[type="text"] {
            @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent;
        }
        .hs-form .hs-submit .hs-button {
            @apply w-full bg-primary text-white py-2 px-4 rounded-md hover:bg-primary-dark transition-colors font-medium;
        }
        .hs-form .hs-error-msgs {
            @apply text-red-600 text-sm mt-1;
        }
    </style>
</head>
<body class="{{body_class}} bg-white text-gray-900">
    {{!-- Navigation --}}
    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-100">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <a href="https://dentalprice.ai" class="flex items-center space-x-2">
                        <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <span class="text-xl font-bold text-gray-900">DentalPrice AI</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="https://dentalprice.ai" class="text-gray-600 hover:text-primary transition-colors">Home</a>
                        <a href="https://dentalprice.ai/features" class="text-gray-600 hover:text-primary transition-colors">Features</a>
                        <a href="https://dentalprice.ai/pricing" class="text-gray-600 hover:text-primary transition-colors">Pricing</a>
                        <a href="/" class="text-primary font-medium">Blog</a>
                        <a href="https://dentalprice.ai/contact" class="text-gray-600 hover:text-primary transition-colors">Contact</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    {{#if @site.members_enabled}}
                        <button data-portal="true" class="text-gray-600 hover:text-primary transition-colors">
                            Subscribe
                        </button>
                    {{/if}}
                    <a href="https://app.dentalprice.ai" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        Get Started
                    </a>
                </div>
            </div>
        </nav>
    </header>

    {{!-- Main content --}}
    <main class="min-h-screen">
        {{{body}}}
    </main>

    {{!-- Footer --}}
    <footer class="bg-gray-900 text-white py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">DentalPrice AI</h3>
                    <p class="text-gray-400">
                        AI-powered dental cost transparency platform
                    </p>
                </div>
                <div>
                    <h4 class="font-semibold mb-3">Product</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="https://dentalprice.ai/features" class="hover:text-white transition-colors">Features</a></li>
                        <li><a href="https://dentalprice.ai/pricing" class="hover:text-white transition-colors">Pricing</a></li>
                        <li><a href="https://app.dentalprice.ai" class="hover:text-white transition-colors">Dashboard</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-3">Resources</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/" class="hover:text-white transition-colors">Blog</a></li>
                        <li><a href="https://dentalprice.ai/docs" class="hover:text-white transition-colors">Documentation</a></li>
                        <li><a href="https://dentalprice.ai/api" class="hover:text-white transition-colors">API</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-3">Company</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="https://dentalprice.ai/about" class="hover:text-white transition-colors">About</a></li>
                        <li><a href="https://dentalprice.ai/contact" class="hover:text-white transition-colors">Contact</a></li>
                        <li><a href="https://dentalprice.ai/privacy" class="hover:text-white transition-colors">Privacy</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
                <p>&copy; {{date format="YYYY"}} DentalPrice AI. All rights reserved.</p>
            </div>
        </div>
    </footer>

    {{!-- HubSpot Form Modal --}}
    <div id="pdf-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-8 m-4 max-w-md w-full relative">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">&times;</button>
            
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Get Your Free PDF Study</h2>
                <p class="text-gray-600">Enter your email to download instantly</p>
            </div>
            
            {{!-- HubSpot Form Container --}}
            <div id="hubspot-form" class="mb-4">
                {{!-- Form will be loaded here by HubSpot --}}
            </div>
            
            {{!-- Fallback Form (hidden by default) --}}
            <div id="fallback-form" class="hidden">
                <form id="email-form" class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="email" name="email" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter your email">
                    </div>
                    <button type="submit" 
                            class="w-full bg-primary text-white py-2 px-4 rounded-md hover:bg-primary-dark transition-colors font-medium">
                        Download PDF Study
                    </button>
                </form>
                <div id="fallback-success" class="hidden text-center py-4">
                    <div class="text-green-600 mb-2">✓ Success!</div>
                    <p class="text-sm text-gray-600">Thank you! We'll send you the PDF study shortly.</p>
                </div>
            </div>
            
            {{!-- Loading State --}}
            <div id="form-loading" class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <p class="mt-2 text-gray-600">Loading form...</p>
            </div>
        </div>
    </div>
    
    {{!-- Trigger Button (can be placed anywhere) --}}
    <div class="fixed bottom-6 right-6 z-40">
        <button id="open-pdf-modal" 
                class="bg-primary text-white px-6 py-3 rounded-full shadow-lg hover:bg-primary-dark transition-all hover:shadow-xl transform hover:scale-105 flex items-center space-x-2">
            <span>📄</span>
            <span class="font-medium">Free PDF Study</span>
        </button>
    </div>

    {{!-- HubSpot Forms Script --}}
    <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
    
    {{!-- Modal and Form Logic --}}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('pdf-modal');
            const openBtn = document.getElementById('open-pdf-modal');
            const closeBtn = document.getElementById('close-modal');
            const hubspotForm = document.getElementById('hubspot-form');
            const fallbackForm = document.getElementById('fallback-form');
            const loadingState = document.getElementById('form-loading');
            const emailForm = document.getElementById('email-form');
            const fallbackSuccess = document.getElementById('fallback-success');
            
            let hubspotLoaded = false;
            let hubspotTimeout;
            
            // Open modal
            openBtn.addEventListener('click', function() {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Try to load HubSpot form if not already loaded
                if (!hubspotLoaded) {
                    loadHubSpotForm();
                }
            });
            
            // Close modal
            function closeModal() {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
            
            closeBtn.addEventListener('click', closeModal);
            
            // Close on background click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Close on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
            
            // Load HubSpot Form
            function loadHubSpotForm() {
                console.log('Loading HubSpot form...');
                
                // Reset states
                loadingState.style.display = 'block';
                hubspotForm.style.display = 'block';
                fallbackForm.classList.add('hidden');
                
                // Set timeout for fallback
                hubspotTimeout = setTimeout(function() {
                    console.warn('HubSpot form load timeout (8 seconds), showing fallback');
                    showFallbackForm();
                }, 8000); // 8 second timeout
                
                // Check if HubSpot script is loaded
                if (typeof hbspt === 'undefined') {
                    console.error('HubSpot script (hbspt) is not loaded');
                    showFallbackForm();
                    return;
                }
                
                try {
                    console.log('Creating HubSpot form with Portal ID: 26874015, Form ID: 5c1bfe1f-5d33-4d30-ad1c-b14bb6bb4bc3');
                    
                    hbspt.forms.create({
                        region: "na1",
                        portalId: "26874015",
                        formId: "5c1bfe1f-5d33-4d30-ad1c-b14bb6bb4bc3",
                        target: "#hubspot-form",
                        onFormReady: function($form) {
                            console.log('✓ HubSpot form ready and rendered');
                            clearTimeout(hubspotTimeout);
                            hubspotLoaded = true;
                            loadingState.style.display = 'none';
                        },
                        onFormSubmit: function($form) {
                            console.log('📤 HubSpot form submitted');
                        },
                        onFormSubmitted: function($form) {
                            console.log('✅ HubSpot form submission completed successfully');
                            
                            // Show success message in the form area
                            hubspotForm.innerHTML = `
                                <div class="text-center py-6">
                                    <div class="text-green-600 text-4xl mb-2">✓</div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Thank you!</h3>
                                    <p class="text-gray-600">Your PDF study will be sent to your email shortly.</p>
                                </div>
                            `;
                            
                            // Close modal after 3 seconds
                            setTimeout(closeModal, 3000);
                        },
                        onFormFailedValidation: function($form) {
                            console.log('⚠️ HubSpot form validation failed');
                        },
                        onFormError: function($form, error) {
                            console.error('❌ HubSpot form error:', error);
                        }
                    });
                } catch (error) {
                    console.error('❌ Error creating HubSpot form:', error);
                    showFallbackForm();
                }
            }
            
            // Show fallback form
            function showFallbackForm() {
                console.log('📋 Showing fallback form');
                clearTimeout(hubspotTimeout);
                loadingState.style.display = 'none';
                hubspotForm.style.display = 'none';
                fallbackForm.classList.remove('hidden');
            }
            
            // Handle fallback form submission
            emailForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                
                console.log('📧 Fallback form submitted with email:', email);
                
                // Basic email validation
                if (!email || !email.includes('@')) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // Show loading state
                const submitBtn = emailForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Sending...';
                submitBtn.disabled = true;
                
                // Simulate API call (replace with your actual endpoint)
                setTimeout(function() {
                    // Here you would typically send the email to your server
                    // For now, just show success message
                    console.log('✅ Fallback form processed successfully');
                    
                    emailForm.style.display = 'none';
                    fallbackSuccess.classList.remove('hidden');
                    
                    // Close modal after 4 seconds
                    setTimeout(closeModal, 4000);
                }, 1000);
            });
            
            // Debug: Log HubSpot script loading status
            let scriptCheckCount = 0;
            const checkHubSpotScript = setInterval(function() {
                scriptCheckCount++;
                if (typeof hbspt !== 'undefined') {
                    console.log(`✅ HubSpot script loaded successfully (check #${scriptCheckCount})`);
                    clearInterval(checkHubSpotScript);
                } else if (scriptCheckCount >= 10) {
                    console.error('❌ HubSpot script failed to load after 10 checks (5 seconds)');
                    clearInterval(checkHubSpotScript);
                } else {
                    console.log(`⏳ Checking HubSpot script... (attempt ${scriptCheckCount}/10)`);
                }
            }, 500);
            
            // Auto-show modal after 15 seconds on first visit (for testing)
            // Comment this out in production if you don't want auto-popup
            setTimeout(function() {
                if (!sessionStorage.getItem('pdf-modal-shown')) {
                    console.log('🔔 Auto-showing PDF modal for first-time visitor');
                    openBtn.click();
                    sessionStorage.setItem('pdf-modal-shown', 'true');
                }
            }, 15000);
        });
    </script>

    {{ghost_foot}}
</body>
</html>